# What's this?

This is an example to try to build rust code which depends on Graphviz written in C/C++ and CMake.

I believe that [CMake crate](https://crates.io/crates/cmake) should help linking Rust code and C code.

Note: 
- These steps were made with reference to [hpcc-js-wasm](https://github.com/hpcc-systems/hpcc-js-wasm).
- @yskszk63 gave me another solution with https://github.com/yskszk63/wasinodot.

# How to build

It should be built by only executing `cargo build` command, but I'm not sure about Cargo building features and don't enoughly understand the buildings steps hpcc-js-wasm show me. So for now, there are sevral steps that are not good enough.

It should be organized in the near future.

## 1. init submodules.

The `graphviz-sys` is a sub cargo project to build Graphviz with CMake crate. It depends on [graphviz source codes](https://gitlab.com/graphviz/graphviz/-/tree/2.50.0) which is git submodule named as `src-graphviz`, so they have to be initialized with the following git commands.

```shell
$ git submodule init && git submodule update
```

## 2. Build Graphviz - step1

Run cmake using Graphviz original CMakeLists.txt. I don't enoughly understand why hpcc-js-wasm uses 2-steps building, but the 2nd step looks depending on some files generated by the 1st step.

```shell
$ ./pre-build.sh
```

To re-try, remove `src-graphviz/build` dir once manually.

## 3. Build Graphviz - step2

```shell
$ cargo build --target wasm32-wasi
```

Note: The steps written in `cmake-install.sh` are integrated into build.rs.